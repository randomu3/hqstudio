<Window x:Class="HQStudio.Views.Dialogs.EditServiceDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑƒÑÐ»ÑƒÐ³Ð¸" 
        Height="620" Width="520"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize"
        KeyDown="Window_KeyDown"
        FocusManager.FocusedElement="{Binding ElementName=NameBox}">

    <Border Background="{DynamicResource BgDialogBrush}" CornerRadius="16" BorderBrush="{DynamicResource BorderDefaultBrush}" BorderThickness="1">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="50"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" Background="{DynamicResource BgDialogHeaderBrush}" CornerRadius="16,16,0,0" 
                    MouseLeftButtonDown="Header_MouseLeftButtonDown">
                <Grid>
                    <TextBlock x:Name="TitleText" Text="ÐÐ¾Ð²Ð°Ñ ÑƒÑÐ»ÑƒÐ³Ð°" FontSize="15" FontWeight="SemiBold" 
                               Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center" Margin="20,0"/>
                    <Button Content="âœ•" HorizontalAlignment="Right" Click="Close_Click"
                            Background="Transparent" Foreground="#606060" BorderThickness="0"
                            Width="50" Height="50" FontSize="14" Cursor="Hand"/>
                </Grid>
            </Border>

            <!-- Form -->
            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="24,20">
                <StackPanel>
                    <!-- Ð˜ÐºÐ¾Ð½ÐºÐ° -->
                    <TextBlock Text="Ð˜ÐšÐžÐÐšÐ" Style="{DynamicResource TextLabel}" Margin="0,0,0,8"/>
                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Ð’Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð°Ñ Ð¸ÐºÐ¾Ð½ÐºÐ° -->
                        <Border Grid.Column="0" Width="60" Height="60" CornerRadius="12" 
                                Background="{DynamicResource BgIconBrush}" Margin="0,0,16,0">
                            <TextBlock x:Name="SelectedIconDisplay" Text="ðŸ”§" FontSize="32" 
                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        
                        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð²Ñ‹Ð±Ð¾Ñ€Ð° -->
                        <Button Grid.Column="1" x:Name="SelectIconButton" Content="Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð¸ÐºÐ¾Ð½ÐºÑƒ..." 
                                Style="{DynamicResource SecondaryButton}" Height="40"
                                Click="SelectIcon_Click" HorizontalAlignment="Left" Padding="20,0"/>
                    </Grid>
                    
                    <!-- ÐŸÐ°Ð½ÐµÐ»ÑŒ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ð¸ÐºÐ¾Ð½Ð¾Ðº (ÑÐºÑ€Ñ‹Ñ‚Ð° Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ) -->
                    <Border x:Name="IconPickerPanel" Visibility="Collapsed" 
                            Background="{DynamicResource BgIconBrush}" CornerRadius="12" 
                            Padding="12" Margin="0,0,0,16">
                        <StackPanel>
                            <TextBlock Text="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸ÐºÐ¾Ð½ÐºÑƒ:" FontSize="12" Foreground="#707070" Margin="0,0,0,8"/>
                            <ItemsControl x:Name="IconsGrid">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Button Width="48" Height="48" Margin="2" Cursor="Hand"
                                                Click="IconItem_Click" Tag="{Binding Icon}"
                                                ToolTip="{Binding Name}"
                                                Background="Transparent" BorderThickness="0">
                                            <Button.Template>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="IconBorder" Background="#1A1A1A" CornerRadius="8"
                                                            BorderThickness="2" BorderBrush="Transparent">
                                                        <TextBlock Text="{Binding Icon}" FontSize="24" 
                                                                   HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="IconBorder" Property="Background" Value="#2A2A2A"/>
                                                            <Setter TargetName="IconBorder" Property="BorderBrush" Value="#4CAF50"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Button.Template>
                                        </Button>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <TextBlock Text="ÐÐÐ—Ð’ÐÐÐ˜Ð•" Style="{DynamicResource TextLabel}" Margin="0,0,0,8"/>
                    <TextBox x:Name="NameBox" Style="{DynamicResource InputText}" Margin="0,0,0,16"
                             TextChanged="NameBox_TextChanged"/>

                    <TextBlock Text="ÐšÐÐ¢Ð•Ð“ÐžÐ Ð˜Ð¯" Style="{DynamicResource TextLabel}" Margin="0,0,0,8"/>
                    <TextBox x:Name="CategoryBox" Style="{DynamicResource InputText}" Margin="0,0,0,16"/>

                    <TextBlock Text="Ð¦Ð•ÐÐ ÐžÐ¢ (â‚½)" Style="{DynamicResource TextLabel}" Margin="0,0,0,8"/>
                    <TextBox x:Name="PriceBox" Style="{DynamicResource InputText}" Margin="0,0,0,16"/>

                    <TextBlock Text="ÐžÐŸÐ˜Ð¡ÐÐÐ˜Ð•" Style="{DynamicResource TextLabel}" Margin="0,0,0,8"/>
                    <TextBox x:Name="DescriptionBox" Style="{DynamicResource InputText}" 
                             TextWrapping="Wrap" AcceptsReturn="True" Height="100"
                             VerticalContentAlignment="Top"/>
                </StackPanel>
            </ScrollViewer>

            <!-- Buttons -->
            <Border Grid.Row="2" Background="{DynamicResource BgDialogHeaderBrush}" Padding="24,16" CornerRadius="0,0,16,16">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Button Grid.Column="0" Content="ÐžÑ‚Ð¼ÐµÐ½Ð°" Style="{DynamicResource BtnSecondary}" 
                            Click="Cancel_Click" Margin="0,0,8,0" IsCancel="True"/>
                    <Button Grid.Column="1" Content="Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ" Style="{DynamicResource BtnPrimary}" 
                            Click="Save_Click" Margin="8,0,0,0" IsDefault="True"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
